var fmwp_replies_page=2,fmwp_no_replies_template=fmwp_front_data.can_reply?'<span class="fmwp-topic-no-replies">'+wp.i18n.__('No one has replied to this topic. Be the first and <a href="javascript:void(0);" class="fmwp-write-reply fmwp-login-to-action" data-fmwp_popup_title="Login to reply to this topic">leave a reply</a>.',"forumwp")+"</span>":'<span class="fmwp-topic-no-replies">'+wp.i18n.__("No one has replied to this topic.","forumwp")+"</span>",fmwp_no_replies_locked_template='<span class="fmwp-topic-no-replies">'+wp.i18n.__("No one has replied to this topic.","forumwp")+"</span>",fmwp_topic_hash=window.location.hash.substr(1),fmwp_selected_reply=!1,fmwp_delay_reply_loading=!1,fmwp_selected_reply_next_offset=!1;function fmwp_get_replies(t,r){fmwp_set_busy("individual_topic",!0);var e={topic_id:t.data("fmwp_topic_id"),page:r.page,order:r.order,nonce:fmwp_front_data.nonce};fmwp_selected_reply&&1===parseInt(r.page)&&(e.reply_id=fmwp_selected_reply),fmwp_selected_reply_next_offset&&(e.offset=fmwp_selected_reply_next_offset),wp.ajax.send("fmwp_get_replies",{data:e,success:function(e){if(fmwp_selected_reply||e.length){var p=wp.template("fmwp-replies-list"),l="";l=p(fmwp_selected_reply?{replies:e.replies,sub_template:!1}:{replies:e,sub_template:!1}),t.data("order",r.order),t.find(".fmwp-load-more").remove(),1!==r.page||fmwp_selected_reply_next_offset?t.append(l+'<span class="fmwp-load-more"></span>'):t.html(l+'<span class="fmwp-load-more"></span>'),fmwp_replies_page=parseInt(r.page)+1,fmwp_selected_reply_next_offset=!1,fmwp_selected_reply&&e.scroll_to&&(jQuery("#fmwp-reply-"+e.scroll_to).is(":visible")?(fmwp_replies_page=e.next_page,fmwp_selected_reply_next_offset=e.next_offset,jQuery("html").animate({scrollTop:jQuery("#fmwp-reply-"+e.scroll_to).offset().top},1e3,function(){e.scroll_to==fmwp_selected_reply&&jQuery("#fmwp-reply-"+e.scroll_to).addClass("fmwp-focus-reply"),e.expand_child&&jQuery("#fmwp-reply-"+e.scroll_to).find(".fmwp-show-child-replies").length?jQuery("#fmwp-reply-"+e.scroll_to).find(".fmwp-show-child-replies").trigger("click"):fmwp_delay_reply_loading=fmwp_selected_reply=!1})):fmwp_delay_reply_loading=fmwp_selected_reply=!1)}else t.find(".fmwp-load-more").remove(),1!==r.page||fmwp_selected_reply_next_offset?fmwp_selected_reply_next_offset&&(fmwp_selected_reply_next_offset=!1,t.find(".fmwp-load-more").remove()):t.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-locked")||t.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-pending")||t.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-spam")?t.html(fmwp_no_replies_locked_template):t.html(fmwp_no_replies_template);fmwp_embed_resize_async(),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),jQuery(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}jQuery(document).ready(function(o){fmwp_embed_containers.push(".fmwp-topic-data-content"),fmwp_embed_containers.push(".fmwp-reply-content"),fmwp_topic_hash&&0===fmwp_topic_hash.indexOf("reply")&&(fmwp_selected_reply=parseInt(fmwp_topic_hash.replace("reply-","")),fmwp_delay_reply_loading=!0),o(".fmwp-topic-wrapper").each(function(){fmwp_get_replies(o(this),{page:1,order:o(this).data("order")})});var p={allow:!0,reallow:function(){p.allow=!0},delay:400};o(window).scroll(function(){if(!fmwp_delay_reply_loading&&!fmwp_is_busy("individual_topic")&&p.allow){p.allow=!1;var e=o(".fmwp-topic-wrapper .fmwp-load-more");if(e.length)setTimeout(p.reallow,p.delay),e.offset().top-o(window).scrollTop()<1e3&&fmwp_get_replies(o(".fmwp-topic-wrapper"),{page:fmwp_replies_page,order:o(".fmwp-topic-wrapper").data("order")})}}),o(document.body).on("change",".fmwp-topic-sort",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=o(this).parents(".fmwp-topic-content").find(".fmwp-topic-wrapper"),l=o(this).val();fmwp_get_replies(p,{page:fmwp_replies_page=1,order:l})}}),o(document.body).on("click",".fmwp-show-child-replies",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var t=o(this),r=t.closest(".fmwp-reply-row"),p=r.data("reply_id"),s=r.find(".fmwp-reply-children");if(t.hasClass("fmwp-replies-loaded"))s.is(":visible")?(r.find("> .fmwp-reply-child-connect").hide(),s.slideUp()):(r.find("> .fmwp-reply-child-connect").show(),s.slideDown());else{var l={reply_id:p,order:o(this).parents(".fmwp-topic-content").find(".fmwp-topic-wrapper").data("order"),nonce:fmwp_front_data.nonce};fmwp_selected_reply&&(l.search_reply=fmwp_selected_reply),fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_get_child_replies",{data:l,success:function(e){var p=wp.template("fmwp-replies-list"),l="";l=p(fmwp_selected_reply?{replies:e.replies,sub_template:!0}:{replies:e,sub_template:!0}),s.append(l),r.find("> .fmwp-reply-child-connect").show(),s.slideDown(),fmwp_embed_resize_async(),t.addClass("fmwp-replies-loaded"),fmwp_selected_reply&&e.scroll_to&&(jQuery("#fmwp-reply-"+e.scroll_to).is(":visible")?jQuery("html").animate({scrollTop:jQuery("#fmwp-reply-"+e.scroll_to).offset().top},1e3,function(){e.scroll_to==fmwp_selected_reply&&jQuery("#fmwp-reply-"+e.scroll_to).addClass("fmwp-focus-reply"),e.expand_child?jQuery("#fmwp-reply-"+e.scroll_to).find(".fmwp-show-child-replies").trigger("click"):fmwp_delay_reply_loading=fmwp_selected_reply=!1}):fmwp_delay_reply_loading=fmwp_selected_reply=!1),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),o(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}})});