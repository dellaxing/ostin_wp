var fmwp_forums_page=2,fmwp_no_forums_search_template='<span class="fmwp-no-forums">'+wp.i18n.__("No results found.","forumwp")+"</span>";function fmwp_get_forums(a,e){fmwp_set_busy("forums_list",!0);var r={page:e.page,order:e.order,category:a.data("category_id"),with_sub:a.data("with_subcategories"),nonce:fmwp_front_data.nonce};e.search&&(r.search=e.search),wp.ajax.send("fmwp_get_forums",{data:r,success:function(r){if(r.forums.length){r.actions?a.siblings(".fmwp-forums-wrapper-heading").removeClass("fmwp-no-actions-heading"):1===e.page&&a.siblings(".fmwp-forums-wrapper-heading").addClass("fmwp-no-actions-heading");var s=wp.template("fmwp-forums-list")({forums:r.forums});a.find(".fmwp-load-more").remove(),1===e.page?a.html(s+'<span class="fmwp-load-more"></span>'):a.append(s+'<span class="fmwp-load-more"></span>'),fmwp_forums_page=parseInt(e.page)+1}else a.find(".fmwp-load-more").remove(),1===e.page&&(e.search?a.html(fmwp_no_forums_search_template):a.html('<span class="fmwp-no-forums">'+a.data("no-forums-text")+"</span>"),a.siblings(".fmwp-forums-wrapper-heading").addClass("fmwp-no-actions-heading"));fmwp_set_busy("forums_list",!1)},error:function(r){console.log(r),fmwp_set_busy("forums_list",!1)}})}jQuery(document).ready(function(o){o(".fmwp-forums-wrapper").each(function(){var r=o(this).parents(".fmwp-archive-forums-wrapper").data("order");fmwp_get_forums(o(this),{page:1,order:r})}),o(window).scroll(function(){var r={allow:!0,reallow:function(){r.allow=!0},delay:400};if(!fmwp_is_busy("forums_list")&&r.allow){r.allow=!1;var s=o(".fmwp-forums-wrapper").parents(".fmwp-archive-forums-wrapper").find(".fmwp-forums-search-line").val(),a=o(".fmwp-forums-wrapper").parents(".fmwp-archive-forums-wrapper").data("order"),e=o(".fmwp-forums-wrapper .fmwp-load-more");if(e.length)setTimeout(r.reallow,r.delay),e.offset().top-o(window).scrollTop()<1e3&&fmwp_get_forums(o(".fmwp-forums-wrapper"),{page:fmwp_forums_page,order:a,search:s})}}),o(document.body).on("click",".fmwp-search-forum",function(r){if(r.preventDefault(),!fmwp_is_busy("forums_list")){var s=o(this).siblings("label").find(".fmwp-forums-search-line").val(),a=o(this).parents(".fmwp-forums-list-head").data("fmwp_search");if(void 0===a&&""===s||a===s)return!1;var e=o(this).parents(".fmwp-archive-forums-wrapper").data("order");o(this).parents(".fmwp-forums-list-head").data("fmwp_search",s),fmwp_forums_page=1,fmwp_get_forums(o(this).parents(".fmwp-forums-list-head").siblings(".fmwp-forums-wrapper"),{page:1,search:s,order:e})}}),o(document.body).on("keypress",".fmwp-forums-search-line",function(r){13===r.which&&o(this).parents("label").siblings(".fmwp-search-forum").trigger("click")})});