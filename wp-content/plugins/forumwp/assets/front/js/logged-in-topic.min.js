jQuery(document).ready(function(f){f(document.body).on("click",".fmwp-edit-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var i=f("#fmwp-topic-popup-wrapper"),t=f("#fmwptopiccontent");if(i.is(":visible"))t.focus();else{var o=f(this).closest(".fmwp-topic-base").data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_get_topic",{data:{topic_id:o,nonce:fmwp_front_data.nonce},success:function(e){if(fmwp_init_tags_suggest(f('input[name="fmwp-topic[tags]"]')),i.find('input[name="fmwp-action"]').val("edit-topic"),i.find('input[name="fmwp-topic[topic_id]"]').val(o),i.find('input[name="fmwp-topic[title]"]').val(e.title),i.find('input[name="fmwp-topic[tags]"]').val(e.tags),wp.hooks.doAction("fmwp_on_open_edit_topic_popup",e,i),"undefined"!=typeof tinymce){var p=tinymce.get("fmwptopiccontent");p&&p instanceof tinymce.Editor&&p.setContent(e.orig_content,{format:"html"})}t.val(e.orig_content).trigger("keyup"),f("#fmwptopiccontent-preview").html(e.content),i.trigger("fmwp_topic_popup_loaded",{data:e}),i.find("input, #wp-fmwptopiccontent-wrap").removeClass("fmwp-error-field").removeAttr("title"),i.show(1,function(){t.focus(),fmwp_resize_popup(),fmwp_autocomplete_mentions(),f(document).trigger("fmwp_edit_topic")}),i.data("fmwp-target","topic-page"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}}),f(document.body).on("click",".fmwp-write-reply",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")&&!(f(this).parents(".fmwp-reply-row").hasClass("fmwp-reply-trashed")||f(this).parents(".fmwp-reply-row").hasClass("fmwp-reply-spam")||f(this).parents(".fmwp-reply-row").hasClass("fmwp-reply-pending"))){var p=f("#fmwp-reply-popup-wrapper"),i=f("#fmwpreplycontent");p.find('input[name="fmwp-action"]').val("create-reply"),p.find('input[name="fmwp-reply[reply_id]"]').val("");var t=f(this).data("mention");if(void 0!==t?(i.val(t+" ").trigger("keyup"),p.find('input[name="fmwp-reply[parent_id]"]').val(f(this).data("reply_id")),""!==f('.fmwp-reply-row[data-reply_id="'+f(this).data("reply_id")+'"] .fmwp-reply-children').html()&&f('.fmwp-reply-row[data-reply_id="'+f(this).data("reply_id")+'"] .fmwp-reply-children').is(":visible")||f('.fmwp-reply-row[data-reply_id="'+f(this).data("reply_id")+'"] .fmwp-reply-base').find(".fmwp-show-child-replies").trigger("click")):(i.val("").trigger("keyup"),p.find('input[name="fmwp-reply[parent_id]"]').val("")),p.find("input, #wp-fmwpreplycontent-wrap").removeClass("fmwp-error-field").removeAttr("title"),p.is(":visible")){if(fmwp_responsive(),i.focus(),"undefined"!=typeof tinymce){var o=tinymce.get("fmwpreplycontent");o&&o instanceof tinymce.Editor&&o.setContent(i.val(),{format:"html"}),tinymce.execCommand("mceFocus",!1,"fmwpreplycontent"),tinymce.activeEditor.focus(),tinymce.activeEditor.selection.select(tinymce.activeEditor.getBody(),!0),tinymce.activeEditor.selection.collapse(!1)}fmwp_resize_popup(),fmwp_autocomplete_mentions(),f(document).trigger("fmwp_create_reply")}else p.show(1,function(){if(fmwp_responsive(),i.focus(),"undefined"!=typeof tinymce){var e=tinymce.get("fmwpreplycontent");e&&e instanceof tinymce.Editor&&e.setContent(i.val(),{format:"html"}),tinymce.execCommand("mceFocus",!1,"fmwpreplycontent"),tinymce.activeEditor.focus(),tinymce.activeEditor.selection.select(tinymce.activeEditor.getBody(),!0),tinymce.activeEditor.selection.collapse(!1)}fmwp_resize_popup(),fmwp_autocomplete_mentions(),f(document).trigger("fmwp_create_reply")})}}),f(document.body).on("click",".fmwp-edit-reply",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var i=f("#fmwp-reply-popup-wrapper"),t=f("#fmwpreplycontent"),o=f(this).closest(".fmwp-reply-row").data("reply_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_get_reply",{data:{reply_id:o,nonce:fmwp_front_data.nonce},success:function(e){if(i.find('input[name="fmwp-action"]').val("edit-reply"),i.find('input[name="fmwp-reply[parent_id]"]').val(e.parent_id),i.find('input[name="fmwp-reply[reply_id]"]').val(o),"undefined"!=typeof tinymce){var p=tinymce.get("fmwpreplycontent");p&&p instanceof tinymce.Editor&&p.setContent(e.orig_content,{format:"html"})}t.val(e.orig_content).trigger("keyup"),f("#fmwpreplycontent-preview").html(e.content),i.trigger("fmwp_reply_popup_loaded",{data:e}),i.find("input, #wp-fmwpreplycontent-wrap").removeClass("fmwp-error-field").removeAttr("title"),i.is(":visible")?(t.focus(),fmwp_resize_popup(),fmwp_autocomplete_mentions(),f(document).trigger("fmwp_edit_reply")):i.show(1,function(){t.focus(),fmwp_resize_popup(),fmwp_autocomplete_mentions(),f(document).trigger("fmwp_edit_reply")}),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-report-reply",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-reply-row"),t=i.data("reply_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_report_reply",{data:{reply_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.addClass("fmwp-reply-reported"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-unreport-reply",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-reply-row"),t=i.data("reply_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_unreport_reply",{data:{reply_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.removeClass("fmwp-reply-reported"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-clear-reports-reply",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-reply-row"),t=i.data("reply_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_clear_reports_reply",{data:{reply_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.removeClass("fmwp-reply-reported"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-mark-spam-reply",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-reply-row"),t=i.data("reply_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_mark_spam_reply",{data:{reply_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.data("spam",!0).addClass("fmwp-reply-spam"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-restore-spam-reply",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-reply-row"),t=i.data("reply_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_restore_spam_reply",{data:{reply_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.data("spam",!1).removeClass("fmwp-reply-spam"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-trash-reply",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")&&confirm(wp.i18n.__("Are you sure to trash this reply?","forumwp"))){var p=f(this),i=f(this).closest(".fmwp-reply-row"),t=i.data("reply_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_trash_reply",{data:{reply_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.addClass("fmwp-reply-trashed").removeClass("fmwp-reply-pending").data("trashed",!0),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-restore-reply",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")&&confirm(wp.i18n.__("Are you sure to restore this reply?","forumwp"))){var p=f(this),i=f(this).closest(".fmwp-reply-row"),t=i.data("reply_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_restore_reply",{data:{reply_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.removeClass("fmwp-reply-trashed").data("trashed",!1),"pending"===e.status&&i.addClass("fmwp-reply-pending"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-remove-reply",function(){if(!fmwp_is_busy("individual_topic")&&confirm(wp.i18n.__("Are you sure to delete permanently this reply. This operation can not be canceled.","forumwp"))){var a=f(this),r=f(this).closest(".fmwp-reply-row"),e=r.data("reply_id"),c=r.parent().closest(".fmwp-reply-row").length,d=r.parent().closest(".fmwp-reply-row").parent().closest(".fmwp-reply-row").length;fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_delete_reply",{data:{order:f(".fmwp-topic-wrapper").data("order"),reply_id:e,nonce:fmwp_front_data.nonce},success:function(i){var e=r.parents(".fmwp-topic-wrapper");if(d)var p=(t=r.parent().closest(".fmwp-reply-row")).parent().closest(".fmwp-reply-row");else if(c)var t=r.parent().closest(".fmwp-reply-row");if("sub_delete"===i.sub_delete)0===parseInt(i.statistic.replies)&&a.parents(".fmwp-topic-wrapper").html(fmwp_no_replies_template),r.remove();else if("change_level"===i.sub_delete){if(d)r.remove();else if(c){var o="";f.each(i.child_replies,function(e){var p=wp.template("fmwp-parent-reply");i.child_replies[e].sub_template=!0,o+=p(i.child_replies[e])}),r.replaceWith(o)}else{o="";f.each(i.child_replies,function(e){var p=wp.template("fmwp-parent-reply");i.child_replies[e].sub_template=!1,o+=p(i.child_replies[e])}),0===parseInt(i.statistic.replies)&&a.parents(".fmwp-topic-wrapper").html(fmwp_no_replies_template),r.replaceWith(o)}fmwp_embed_resize_async()}if(d){var n=wp.template("fmwp-subreplies-list")(i.parent_data),s=wp.template("fmwp-subreplies-list")(i.parent_parent_data);t.find("> .fmwp-reply-base .fmwp-reply-avatars").replaceWith(n),p.find("> .fmwp-reply-base .fmwp-reply-avatars").replaceWith(s),0==i.parent_data.total_replies&&t.find("> .fmwp-reply-child-connect").hide()}else if(c){n=wp.template("fmwp-subreplies-list")(i.parent_data);t.find("> .fmwp-reply-base .fmwp-reply-avatars").replaceWith(n)}f("#fmwp-replies-total").html(i.statistic.replies),fmwp_change_topic_sorting_visibility(e),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-report-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-topic-base"),t=i.data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_report_topic",{data:{topic_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.parents(".fmwp-topic-main-wrapper").addClass("fmwp-topic-reported"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-unreport-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-topic-base"),t=i.data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_unreport_topic",{data:{topic_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.parents(".fmwp-topic-main-wrapper").removeClass("fmwp-topic-reported"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-clear-reports-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-topic-base"),t=i.data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_clear_reports_topic",{data:{topic_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.parents(".fmwp-topic-main-wrapper").removeClass("fmwp-topic-reported"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-mark-spam-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-topic-base"),t=i.data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_mark_spam_topic",{data:{topic_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.data("spam",!0),i.parents(".fmwp-topic-main-wrapper").addClass("fmwp-topic-spam"),i.parents(".fmwp-topic-main-wrapper").find(".fmwp-topic-no-replies").length&&(i.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-locked")||i.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-pending")||i.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-spam")?i.parents(".fmwp-topic-main-wrapper").find(".fmwp-topic-wrapper").html(fmwp_no_replies_locked_template):i.parents(".fmwp-topic-main-wrapper").find(".fmwp-topic-wrapper").html(fmwp_no_replies_template)),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-restore-spam-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-topic-base"),t=i.data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_restore_spam_topic",{data:{topic_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.data("spam",!1),i.parents(".fmwp-topic-main-wrapper").removeClass("fmwp-topic-spam"),i.parents(".fmwp-topic-main-wrapper").find(".fmwp-topic-no-replies").length&&(i.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-locked")||i.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-pending")||i.parents(".fmwp-topic-main-wrapper").hasClass("fmwp-topic-spam")?i.parents(".fmwp-topic-main-wrapper").find(".fmwp-topic-wrapper").html(fmwp_no_replies_locked_template):i.parents(".fmwp-topic-main-wrapper").find(".fmwp-topic-wrapper").html(fmwp_no_replies_template)),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-lock-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-topic-base"),t=i.data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_lock_topic",{data:{topic_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.data("locked",!0),i.parents(".fmwp-topic-main-wrapper").addClass("fmwp-topic-locked"),fmwp_set_busy("individual_topic",!1),window.location.reload(!0)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-unlock-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-topic-base"),t=i.data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_unlock_topic",{data:{topic_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.data("locked",!1),i.parents(".fmwp-topic-main-wrapper").removeClass("fmwp-topic-locked"),fmwp_set_busy("individual_topic",!1),window.location.reload(!0)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-pin-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-topic-base"),t=i.data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_pin_topic",{data:{topic_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.data("pinned",!0),i.parents(".fmwp-topic-main-wrapper").addClass("fmwp-topic-pinned"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-unpin-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-topic-base"),t=i.data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_unpin_topic",{data:{topic_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.data("pinned",!1),i.parents(".fmwp-topic-main-wrapper").removeClass("fmwp-topic-pinned"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-trash-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-topic-base"),t=i.data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_trash_topic",{data:{topic_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.data("trashed",!0),i.parents(".fmwp-topic-main-wrapper").addClass("fmwp-topic-trashed"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-restore-topic",function(e){if(e.preventDefault(),!fmwp_is_busy("individual_topic")){var p=f(this),i=f(this).closest(".fmwp-topic-base"),t=i.data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_restore_topic",{data:{topic_id:t,nonce:fmwp_front_data.nonce},success:function(e){fmwp_rebuild_dropdown(e,p),i.data("trashed",!1),i.parents(".fmwp-topic-main-wrapper").removeClass("fmwp-topic-trashed"),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}}),f(document.body).on("click",".fmwp-remove-topic",function(){if(!fmwp_is_busy("individual_topic")&&confirm(wp.i18n.__("Are you sure to delete permanently this topic. This operation can not be canceled.","forumwp"))){f(this);var e=f(this).closest(".fmwp-topic-base").data("topic_id");fmwp_set_busy("individual_topic",!0),wp.ajax.send("fmwp_delete_topic",{data:{topic_id:e,nonce:fmwp_front_data.nonce},success:function(e){f(this).fmwp_notice({message:e.message,type:"update"}),setTimeout(function(){window.location=e.redirect},3e3),fmwp_set_busy("individual_topic",!1)},error:function(e){console.log(e),f(this).fmwp_notice({message:e,type:"error"}),fmwp_set_busy("individual_topic",!1)}})}})});