var fmwp_profile={topics:{page:2,loading:!1},replies:{page:2,loading:!1}};function fmwp_profile_show_loader(e){e.find("> .fmwp-ajax-loading").show()}function fmwp_profile_hide_loader(e){e.find(" > .fmwp-ajax-loading").hide()}function fmwp_profile_replies(p,i){p.find(".fmwp-ajax-loading").show(),fmwp_profile.replies.loading=!0,1===i.page&&p.find(".fmwp-replies-wrapper").html(""),wp.ajax.send("fmwp_profile_replies",{data:{user_id:i.user_id,page:i.page,nonce:fmwp_front_data.nonce},success:function(e){if(p.find(".fmwp-ajax-loading").hide(),p.find(".fmwp-load-more").remove(),e.length){var t=wp.template("fmwp-replies-list")({replies:e});1===i.page?p.find(".fmwp-replies-wrapper").html(t+'<span class="fmwp-load-more"></span>'):p.find(".fmwp-replies-wrapper").append(t+'<span class="fmwp-load-more"></span>'),fmwp_embed_resize_async(),fmwp_profile.replies.page=parseInt(i.page)+1}else 1===i.page&&p.html('<span class="fmwp-profile-no-replies">'+wp.i18n.__("No replies","forumwp")+"</span>");fmwp_profile.replies.loading=!1,fmwp_responsive()},error:function(e){console.log(e),p.find(".fmwp-ajax-loading").hide(),jQuery(this).fmwp_notice({message:e,type:"error"}),fmwp_profile.replies.loading=!1}})}function fmwp_profile_topics(p,i){fmwp_profile.topics.loading=!0,p.find(".fmwp-ajax-loading").show(),1===i.page&&p.find(".fmwp-topics-wrapper").html(""),wp.ajax.send("fmwp_profile_topics",{data:{user_id:i.user_id,page:i.page,nonce:fmwp_front_data.nonce},success:function(e){if(p.find(".fmwp-ajax-loading").hide(),p.find(".fmwp-load-more").remove(),e.length){var t=wp.template("fmwp-topics-list")({topics:e});1===i.page?p.find(".fmwp-topics-wrapper").html(t+'<span class="fmwp-load-more"></span>'):p.find(".fmwp-topics-wrapper").append(t+'<span class="fmwp-load-more"></span>'),fmwp_embed_resize_async(),fmwp_profile.topics.page=parseInt(i.page)+1}else 1===i.page&&p.find(".fmwp-topics-wrapper").html('<span class="fmwp-profile-no-topics">'+wp.i18n.__("No topics","forumwp")+"</span>");fmwp_profile.topics.loading=!1,fmwp_responsive()},error:function(e){console.log(e),p.find(".fmwp-ajax-loading").hide(),jQuery(this).fmwp_notice({message:e,type:"error"}),fmwp_profile.topics.loading=!1}})}jQuery(document).ready(function(n){fmwp_profile=wp.hooks.applyFilters("fmwp_profile_tabs",fmwp_profile),fmwp_embed_containers.push(".fmwp-reply-content"),n(window).on("load",function(){n(".fmwp-profile-wrapper").each(function(){var e=n(this).find(".fmwp-profile-mobile .fmwp-profile-menu > .fmwp-active-tab"),t=e.find("a").data("tab");if(e.siblings(".fmwp-profile-menu-indicator").animate({left:e.position().left,width:e.outerWidth()+"px"}),e.outerWidth()+e.offset().left>=e.parents("ul").outerWidth()){var p=e.outerWidth()-(e.parents("nav").outerWidth()-e.offset().left-e.parents("nav").offset().left)+e.parents("nav").scrollLeft();e.parents("nav").animate({scrollLeft:p})}n(this).find('.fmwp-profile-scroll-content .fmwp-profile-tab-content[data-tab="'+t+'"]');var i=n(this).find('.fmwp-profile-scroll-content .fmwp-profile-tab-content[data-tab="'+t+'"]').offset().left-n(this).find(".fmwp-profile-scroll-content").offset().left+n(this).find(".fmwp-profile-scroll-content").scrollLeft();n(".fmwp-profile-scroll-content").scrollLeft(i)})});var e=n(".fmwp-profile-menu").find("li.fmwp-active-tab > a").data("tab"),t=n('.fmwp-profile-tab-content[data-tab="'+e+'"]').find("li.fmwp-active-tab > a").data("tab"),p=n(".fmwp-profile-wrapper").data("user_id");"topics"===e?fmwp_profile_topics(n(".fmwp-profile-"+e+"-content"),{page:1,user_id:p}):"replies"===e?fmwp_profile_replies(n(".fmwp-profile-"+e+"-content"),{page:1,user_id:p}):wp.hooks.doAction("fmwp_user_profile_tab_loading",e,t,p),n(window).scroll(function(){var e={allow:!0,reallow:function(){e.allow=!0},delay:400};if(n(".fmwp-profile-topics-content:visible").length)!fmwp_profile.topics.loading&&e.allow&&(e.allow=!1,(t=n(".fmwp-profile-topics-content .fmwp-load-more")).length&&(setTimeout(e.reallow,e.delay),t.offset().top-n(window).scrollTop()<1e3&&fmwp_profile_topics(n(".fmwp-profile-topics-content"),{page:fmwp_profile.topics.page,user_id:t.parents(".fmwp-profile-wrapper").data("user_id")})));else if(n(".fmwp-profile-replies-content:visible").length){var t;if(!fmwp_profile.replies.loading&&e.allow)if(e.allow=!1,(t=n(".fmwp-profile-replies-content .fmwp-load-more")).length)setTimeout(e.reallow,e.delay),t.offset().top-n(window).scrollTop()<1e3&&fmwp_profile_replies(n(".fmwp-profile-replies-content"),{page:fmwp_profile.replies.page,user_id:t.parents(".fmwp-profile-wrapper").data("user_id")})}else wp.hooks.doAction("fmwp_user_profile_tab_scroll",e)}),n(document.body).on("click",".fmwp-profile-load-content-link",function(e){if(e.preventDefault(),!n(this).parents("li").hasClass("fmwp-active-tab")){window.history.pushState("string","fmwp-profile-tab",n(this).attr("href"));var p,t=n(this).parents(".fmwp-profile-wrapper"),i=t.data("user_id");n(this).parents(".fmwp.fmwp-ui-xs").length&&!0,n(this).parents("ul").find("li").removeClass("fmwp-active-tab"),n(this).parents("li").addClass("fmwp-active-tab");var o=!n(this).parents(".fmwp-profile-submenu").length;if(o?t.find(".fmwp-profile-content").attr("data-active_tab",n(this).data("tab")):n(this).parents(".fmwp-profile-tab-content").attr("data-active_subtab",n(this).data("tab")),o)n(this).data("ajax")?(p=n(this).data("tab"),insert_to=t.find(".fmwp-profile-content"),insert_to.find(".fmwp-profile-"+p+"-content").length||(fmwp_profile_show_loader(insert_to),wp.ajax.send("fmwp_profile_get_content",{data:{tab:p,user_id:i,nonce:fmwp_front_data.nonce},success:function(e){var t=wp.template("fmwp-profile-"+p)(e);insert_to.append('<div class="fmwp-profile-tab-content fmwp-profile-'+p+'-content">'+t+"</div>"),insert_to.find(".fmwp-profile-"+p+"-content").show(),fmwp_responsive(),fmwp_profile_hide_loader(insert_to),insert_to.trigger("fmwp_profile_tab_loaded",{tab:p,user_id:i})},error:function(e){console.log(e),jQuery(this).fmwp_notice({message:e,type:"error"}),fmwp_profile_hide_loader(insert_to)}}))):"topics"===n(this).data("tab")?fmwp_profile_topics(n(".fmwp-profile-"+n(this).data("tab")+"-content"),{page:1,user_id:i}):"replies"===n(this).data("tab")?fmwp_profile_replies(n(".fmwp-profile-"+n(this).data("tab")+"-content"),{page:1,user_id:i}):wp.hooks.doAction("fmwp_user_profile_not_ajax_tab_loaded",n(this).data("tab"));else p=t.find(".fmwp-profile-menu:visible .fmwp-active-tab a").data("tab"),wp.hooks.doAction("fmwp_user_profile_subtab_loaded",p,n(this).data("tab"),i)}}),n(document.body).on("click",".fmwp-profile-mobile-tab-link",function(e){if(e.preventDefault(),!n(this).parents("li").hasClass("fmwp-active-tab")){window.history.pushState("string","fmwp-profile-tab",n(this).attr("href"));var t=n(this).parents(".fmwp-profile-wrapper"),p=t.data("user_id"),i=n(this).data("tab");n(this).parents("ul").find("li").removeClass("fmwp-active-tab"),n(this).parents("li").addClass("fmwp-active-tab"),t.find(".fmwp-profile-content").attr("data-active_tab",n(this).data("tab"));var o,a=n(this).parents("li");if(a.siblings(".fmwp-profile-menu-indicator").animate({left:a.position().left,width:a.outerWidth()+"px"}),a.outerWidth()+a.offset().left>=a.parents("ul").outerWidth()?(o=a.outerWidth()-(a.parents("nav").outerWidth()-a.offset().left-n(this).parents("nav").offset().left)+n(this).parents("nav").scrollLeft(),n(this).parents("nav").animate({scrollLeft:o})):a.offset().left<0&&(o=a.offset().left-n(this).parents("nav").offset().left+n(this).parents("nav").scrollLeft()-(a.parents("nav").outerWidth()-a.parents("nav").width()),n(this).parents("nav").animate({scrollLeft:o})),n(this).data("ajax")){var f=t.find(".fmwp-profile-scroll-content");r=f.find('.fmwp-profile-tab-content[data-tab="'+i+'"]').offset().left-n(".fmwp-profile-scroll-content").offset().left+n(".fmwp-profile-scroll-content").scrollLeft();n(".fmwp-profile-scroll-content").animate({scrollLeft:r}),f.find(".fmwp-profile-"+i+"-content").hasClass("fmwp-profile-blank-content")&&wp.ajax.send("fmwp_profile_get_content",{data:{tab:i,user_id:p,nonce:fmwp_front_data.nonce},success:function(e){var t=wp.template("fmwp-profile-"+i)(e);f.find(".fmwp-profile-"+i+"-content").removeClass("fmwp-profile-blank-content").html(t),fmwp_responsive(),fmwp_profile_hide_loader(f)},error:function(e){console.log(e),jQuery(this).fmwp_notice({message:e,type:"error"})}})}else{var r=n('.fmwp-profile-tab-content[data-tab="'+i+'"]').offset().left-n(".fmwp-profile-scroll-content").offset().left+n(".fmwp-profile-scroll-content").scrollLeft();n(".fmwp-profile-scroll-content").animate({scrollLeft:r}),"topics"===n(this).data("tab")?fmwp_profile_topics(n(".fmwp-profile-"+n(this).data("tab")+"-content"),{page:1,user_id:p}):"replies"===n(this).data("tab")?fmwp_profile_replies(n(".fmwp-profile-"+n(this).data("tab")+"-content"),{page:1,user_id:p}):wp.hooks.doAction("fmwp_user_profile_not_ajax_tab_loaded_mobile",n(this).data("tab"))}}})});